import{r as x,j as e,A,m as v,a1 as R,a2 as F,y as C,a5 as O,t as L,a6 as U,s as D,a7 as z,L as M}from"./index-LJXkA3a7.js";import{L as $}from"./LazyImage-QJ1uGWf1.js";class B{constructor(){this.events={}}emit(s,i){console.log(`Emitting event: ${s}`,i),this.events[s]&&this.events[s].forEach(a=>{try{a(i)}catch(n){console.error(`Error in event listener for ${s}:`,n)}})}on(s,i){return this.events[s]||(this.events[s]=[]),this.events[s].push(i),()=>{this.events[s]=this.events[s].filter(a=>a!==i)}}off(s,i){this.events[s]&&(this.events[s]=this.events[s].filter(a=>a!==i))}removeAllListeners(s){s?delete this.events[s]:this.events={}}}const V=new B,W={CREATED:"artwork:created",UPDATED:"artwork:updated",DELETED:"artwork:deleted",LIKED:"artwork:liked",UNLIKED:"artwork:unliked",BOOKMARKED:"artwork:bookmarked",UNBOOKMARKED:"artwork:unbookmarked",USER_STATS_UPDATED:"user:stats:updated"},q=({isOpen:t,onClose:s,onSubmit:i,editingArtwork:a=null})=>{const[n,l]=x.useState({title:"",description:"",category:"Traditional",imageUrl:"",isPublic:!0}),[d,m]=x.useState(null),[u,c]=x.useState({}),[k,w]=x.useState(!1),N=["Traditional","Contemporary","Abstract","Landscape","Digital","Portrait"];x.useEffect(()=>{a&&t?(l({title:a.title||"",description:a.description||"",category:a.category||"Traditional",imageUrl:a.imageUrl||a.image||"",isPublic:a.isPublic!==void 0?a.isPublic:!0}),m(a.imageUrl||a.image||null)):!a&&t&&(l({title:"",description:"",category:"Traditional",imageUrl:"",isPublic:!0}),m(null)),c({})},[a,t]);const h=o=>{const{name:r,value:f}=o.target;l(b=>({...b,[r]:f})),u[r]&&c(b=>({...b,[r]:""}))},j=o=>{const r=o.target.files[0];if(r){const f=new FileReader;f.onload=b=>{m(b.target.result),l(E=>({...E,imageUrl:b.target.result}))},f.readAsDataURL(r)}},p=()=>{const o={};return n.title.trim()?n.title.length>50&&(o.title="Title must be 50 characters or less"):o.title="Title is required",n.description.trim()?n.description.length>100&&(o.description="Description must be 100 characters or less"):o.description="Description is required",n.imageUrl||(o.imageUrl="Please upload an image"),c(o),Object.keys(o).length===0},g=o=>{o.preventDefault(),p()&&(i(n),l({title:"",description:"",category:"Traditional",imageUrl:"",isPublic:!0}),m(null),c({}))},y=()=>{l({title:"",description:"",category:"Traditional",imageUrl:"",isPublic:!0}),m(null),c({}),s()};return e.jsx(A,{children:t&&e.jsx(v.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:y,children:e.jsxs(v.div,{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",initial:{scale:.8,opacity:0,y:50},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:50},transition:{duration:.3},onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-900",children:a?"Edit Artwork":"Contribute Your Art"}),e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(R,{size:20})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Artwork Image *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-amber-400 transition-colors",children:d?e.jsx("img",{src:d,alt:"Preview",className:"w-full h-full object-cover rounded-lg"}):e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(F,{className:"w-10 h-10 mb-3 text-gray-400"}),e.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})})]}),u.imageUrl&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.imageUrl})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title * ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",n.title.length,"/50)"]})]}),e.jsx("input",{type:"text",name:"title",value:n.title,onChange:h,placeholder:"Enter artwork title...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",maxLength:"50"}),u.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.title})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Description * ",e.jsxs("span",{className:"text-xs text-gray-500",children:["(",n.description.length,"/100)"]})]}),e.jsx("textarea",{name:"description",value:n.description,onChange:h,placeholder:"Describe your artwork...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent resize-none",maxLength:"100"}),u.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsx("select",{name:"category",value:n.category,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent",children:N.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Publication Status"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"isPublic",value:"true",checked:n.isPublic===!0,onChange:()=>l(o=>({...o,isPublic:!0})),className:"sr-only"}),e.jsxs("div",{className:`flex items-center px-4 py-2 rounded-lg border-2 transition-all ${n.isPublic===!0?"border-green-500 bg-green-50 text-green-700":"border-gray-300 bg-white text-gray-600 hover:border-gray-400"}`,children:[e.jsx("span",{className:"mr-2",children:"📄"}),e.jsx("span",{className:"font-medium",children:"Published"})]})]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"isPublic",value:"false",checked:n.isPublic===!1,onChange:()=>l(o=>({...o,isPublic:!1})),className:"sr-only"}),e.jsxs("div",{className:`flex items-center px-4 py-2 rounded-lg border-2 transition-all ${n.isPublic===!1?"border-yellow-500 bg-yellow-50 text-yellow-700":"border-gray-300 bg-white text-gray-600 hover:border-gray-400"}`,children:[e.jsx("span",{className:"mr-2",children:"📝"}),e.jsx("span",{className:"font-medium",children:"Draft"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:n.isPublic?"Published artworks will be visible to everyone on the Art Wall.":"Draft artworks are only visible to you in your profile."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-amber-600 to-orange-600 text-white px-4 py-2 rounded-lg font-semibold hover:from-amber-700 hover:to-orange-700 transition-all duration-300 shadow-lg hover:shadow-xl",children:a?"Update Artwork":"Submit Artwork"})]})]})]})})})},I=new Set,P=new Map,S=(t,s="default",i={})=>{const a=`${s}:${t}`;if(I.has(a))return null;I.add(a);const l={...{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,onClose:()=>{I.delete(a),P.has(a)&&(clearTimeout(P.get(a)),P.delete(a))}},...i};let d;switch(s){case"success":d=C.success(t,l);break;case"error":d=C.error(t,l);break;case"warning":d=C.warning(t,l);break;case"info":d=C.info(t,l);break;default:d=C(t,l);break}const m=setTimeout(()=>{I.delete(a),P.delete(a)},l.autoClose+1e3);return P.set(a,m),d},T={success:(t,s)=>S(t,"success",s),error:(t,s)=>S(t,"error",s),warning:(t,s)=>S(t,"warning",s),info:(t,s)=>S(t,"info",s),default:(t,s)=>S(t,"default",s)},K=({isOpen:t,onClose:s,reportType:i,targetId:a,targetName:n})=>{const[l,d]=x.useState(""),[m,u]=x.useState(""),[c,k]=x.useState(!1),w={artwork:["Inappropriate Content","Copyright Infringement","Offensive Material","Spam or Misleading","Poor Quality","Other"],artist:["Inappropriate Behavior","Fake Profile","Harassment","Spam Content","Impersonation","Other"]},N=async p=>{if(p.preventDefault(),!l){alert("Please select a reason for reporting.");return}k(!0);try{const g=localStorage.getItem("token"),y=await fetch("/api/reports",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({reportType:i,targetId:a,reason:l,description:m.trim()})});if(y.ok)alert("Report submitted successfully. Thank you for helping keep our community safe."),h();else{const o=await y.json();alert(o.message||"Failed to submit report. Please try again.")}}catch(g){console.error("Error submitting report:",g),alert("Failed to submit report. Please try again.")}finally{k(!1)}},h=()=>{d(""),u(""),k(!1),s()};if(!t)return null;const j=w[i]||[];return e.jsx("div",{className:"report-modal-overlay",onClick:h,children:e.jsxs("div",{className:"report-modal-content",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"report-modal-header",children:[e.jsxs("h2",{children:["Report ",i==="artwork"?"Artwork":"Artist"]}),e.jsx("button",{className:"report-modal-close-btn",onClick:h,disabled:c,children:"×"})]}),e.jsxs("div",{className:"report-modal-body",children:[e.jsxs("p",{className:"report-target-info",children:["Reporting: ",e.jsx("strong",{children:n||`${i} #${a}`})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"report-form-group",children:[e.jsx("label",{children:"Reason for reporting:"}),e.jsx("div",{className:"report-reasons-list",children:j.map(p=>e.jsxs("label",{className:"report-reason-option",children:[e.jsx("input",{type:"radio",name:"reason",value:p,checked:l===p,onChange:g=>d(g.target.value),disabled:c}),e.jsx("span",{children:p})]},p))})]}),e.jsxs("div",{className:"report-form-group",children:[e.jsx("label",{htmlFor:"description",children:"Additional details (optional):"}),e.jsx("textarea",{id:"description",placeholder:"Please provide any additional context or details about this report...",value:m,onChange:p=>u(p.target.value),rows:4,maxLength:1e3,disabled:c}),e.jsxs("small",{className:"char-count",children:[m.length,"/1000 characters"]})]}),e.jsxs("div",{className:"report-modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:h,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit-report",disabled:!l||c,children:c?"Submitting...":"Submit Report"})]})]})]})]})})},G=({artwork:t,index:s,currentUser:i,isBookmarked:a,isLiked:n,onLike:l,onBookmark:d,onImageClick:m})=>{const[u,c]=x.useState(a||!1),[k,w]=x.useState(!1),[N,h]=x.useState(!1),j=i&&i.likes?(()=>{var b;const r=t.id?t.id.toString():(b=t._id)==null?void 0:b.toString(),f=i.likes.some(E=>E.toString()===r);return console.log("ArtCard isLiked calculation:",{artworkId:r,userLikes:i.likes,isLiked:f}),f})():!1;x.useEffect(()=>{var r;if(i&&i.bookmarks){const f=t.id?t.id.toString():(r=t._id)==null?void 0:r.toString();c(i.bookmarks.some(b=>b.toString()===f))}else c(!1)},[i,t.id,t._id]),x.useEffect(()=>{a!==void 0&&c(a)},[a]);const p={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},transition:{duration:.4,delay:s*.1}},g=()=>{if(console.log("ArtCard handleLike clicked:",{artworkId:t.id,currentUser:!!i,onLike:!!l}),!i){console.log("ArtCard handleLike: No current user, showing login toast"),T.error("Please login or create an account to like artworks");return}console.log("ArtCard handleLike: Calling parent onLike function"),l?l(t.id).catch(r=>{console.error("Failed to toggle like:",r)}):console.error("ArtCard handleLike: onLike prop is missing!")},y=()=>{if(!i){T.error("Please login or create an account to bookmark artworks");return}d&&d(t.id).catch(r=>{console.error("Failed to toggle bookmark:",r)})},o=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs(e.Fragment,{children:[e.jsxs(v.div,{className:"bg-white/90 backdrop-blur-sm rounded-3xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 group cursor-pointer",...p,whileHover:{y:-5,scale:1.02},whileTap:{scale:.98},children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx($,{src:t.imageUrl,alt:t.title,className:"w-full h-64 group-hover:scale-110 transition-transform duration-500 cursor-pointer",aspectRatio:"",placeholder:"🎨",onClick:()=>m&&m(t)}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:"bg-amber-600/90 text-white px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm",children:t.category})}),e.jsxs("div",{className:"absolute top-3 right-3 flex space-x-2 z-20",children:[e.jsx("button",{className:"w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-sm bg-white/80 text-gray-600 hover:bg-red-50 hover:text-red-500 transition-all duration-300 z-10",onClick:r=>{if(r.stopPropagation(),!i){T.error("Please login to report content");return}h(!0)},title:"Report artwork",children:e.jsx(O,{size:14})}),e.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-sm transition-all duration-300 z-10 ${u?"bg-amber-600 text-white":"bg-white/80 text-amber-600 hover:bg-amber-50"}`,onClick:r=>{r.stopPropagation(),y()},title:u?"Remove from bookmarks":"Add to bookmarks",children:u?e.jsx(L,{size:16}):e.jsx(U,{size:16})}),e.jsx("button",{className:`w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-sm transition-all duration-300 z-10 cursor-pointer ${j?"bg-red-500 text-white":"bg-white/80 text-red-500 hover:bg-red-50"}`,onClick:r=>{console.log("LIKE BUTTON CLICKED - RAW EVENT"),r.preventDefault(),r.stopPropagation(),g()},onMouseDown:()=>console.log("LIKE BUTTON MOUSE DOWN"),title:j?"Unlike":"Like",children:j?e.jsx(D,{size:16}):e.jsx(z,{size:16})})]})]}),e.jsxs("div",{className:"p-6 flex flex-col space-y-4",children:[e.jsx(v.h3,{className:"text-xl font-bold text-amber-900 line-clamp-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.1+.2},children:t.title}),e.jsx(v.p,{className:"text-sm text-amber-700 leading-relaxed line-clamp-3 flex-grow",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.1+.3},children:t.description}),e.jsxs(v.div,{className:"flex items-center justify-between pt-4 border-t border-amber-100",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.1+.4},children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-amber-700",children:"By: "}),e.jsx(M,{to:(()=>{const r=t.userId||t.artistId;return console.log("ArtCard - artwork.userId:",t.userId,"type:",typeof t.userId),console.log("ArtCard - artwork.artistId:",t.artistId,"type:",typeof t.artistId),console.log("ArtCard - final artistId:",r,"type:",typeof r),r?`/artist/${r}`:"#"})(),className:"font-semibold text-amber-800 hover:text-amber-600 hover:underline transition-colors cursor-pointer",onClick:r=>r.stopPropagation(),children:t.artist})]}),e.jsx("span",{className:"text-xs text-gray-500",children:o(t.createdAt)})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-red-500",children:[e.jsx(D,{size:14}),e.jsx("span",{className:"text-sm font-medium",children:(()=>{const r=Array.isArray(t.likes)?t.likes.length:t.likes??t.likeCount??0;return console.log("ArtCard like display:",{artworkId:t.id,likes:t.likes,likeCount:t.likeCount,displayValue:r}),r})()})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-amber-600",children:[e.jsx(L,{size:14}),e.jsx("span",{className:"text-sm font-medium",children:(()=>{const r=Array.isArray(t.bookmarks)?t.bookmarks.length:t.bookmarks??t.bookmarkCount??0;return console.log("ArtCard bookmark display:",{artworkId:t.id,bookmarks:t.bookmarks,bookmarkCount:t.bookmarkCount,displayValue:r}),r})()})]})]})]})]})]}),e.jsx(K,{isOpen:N,onClose:()=>h(!1),reportType:"artwork",reportedItemId:t.id,reportedItemTitle:t.title})]})};export{W as A,q as C,G as a,V as g,T as s};
